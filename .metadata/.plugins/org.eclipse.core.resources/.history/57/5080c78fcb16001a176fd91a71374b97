<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
	pageEncoding="ISO-8859-1" import="com.cs336.pkg.*"%>
<!--Import some libraries that have classes that we need -->
<%@ page import="java.io.*,java.util.*,java.sql.*,java.text.*"%>
<%@ page import="javax.servlet.http.*,javax.servlet.*"%>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
<title>Item Info Inserting</title>
</head>
<body>
<%

			ApplicationDB db = new ApplicationDB();	
		
			Connection con = db.getConnection();

		//Create a SQL statement
			Statement stmt = con.createStatement();
		
	        String generation=request.getParameter("generation");
	        String network=request.getParameter("network");
	        String brandname=request.getParameter("brandname");
	        String condition=request.getParameter("condition");
	        String operatingsystem= request.getParameter("operatingsystem");
    	    double price= Double.parseDouble(request.getParameter("price"));
    	    double hprice= Double.parseDouble(request.getParameter("hprice"));
    	    if(hprice < 0 || price < 0 || hprice < price)
    	    {
    	    	if(hprice < price)
    	    		out.println("Error, hidden price can't be less than the price!");
    	    	else
    	    		out.println("Error, can't have negative price/hidden price!");
    	    	%><br /><a href="ItemInformation.jsp">Go Back</a><%
    	    }
    	    else
    	    {
	    	    String serialnumber=request.getParameter("serialnumber");
	    	   	String bidDate = request.getParameter("bidDate");
	    	   	String bidTime = request.getParameter("bidTime");
	    	   	double bidInc= Double.parseDouble(request.getParameter("bidInc"));

	    	   	
	    	    SimpleDateFormat sdf = new SimpleDateFormat("yyyy-MM-dd HH:mm:ss.SSS");
	    	    sdf.setTimeZone(TimeZone.getTimeZone("America/New_York"));
	    	  
	    	    java.util.Date now=new java.util.Date();
	    	   	TimeZone.setDefault(TimeZone.getTimeZone("America/New_York"));
	    	    String newDateFormat = bidDate + " " + bidTime + ":00.000";
				java.util.Date newdate= new java.util.Date(sdf.parse(newDateFormat).getTime());
	    	    if(newdate.compareTo(now) == -1)
	    	    {
	    	       	out.println("Error, please choose date/time that is AHEAD of current time! You entered " + newdate+ " current time is " + now);
	    	       	%><br /><a href="ItemInformation.jsp">Go Back</a><%
	    	    }
	    	    else
				{
		    	    String insert = "INSERT INTO Phones(Generation, Network, Brand_Name, Condi, Price, OS, sellerID ,bidExpiration, currentBidder, bidIncrement, hiddenPrice, serialnumber)"
						+ "VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)";
		        	
		    	    PreparedStatement ps = con.prepareStatement(insert);
					
					ps.setString(1, generation);
					ps.setString(2, network);
					ps.setString(3, brandname);
					ps.setString(4, condition);
					ps.setDouble(5, price);
					ps.setString(6, operatingsystem);
			    	ps.setString(7, ""+session.getAttribute("user"));
			    	ps.setString(8, newDateFormat);
			    	ps.setString(9, "None");
			    	ps.setDouble(10, bidInc);
			    	ps.setDouble(11, hprice);
			    	ps.setString(12, serialnumber);
					ps.executeUpdate();
					
					//Close the connection. Don't forget to do it, otherwise you're keeping the resources of the server allocated.
					//out.println(" You entered " + newdate+ " current time is " + now);
					out.println("Added Item Successfully!");
	    	    }
    	    }
		/*	
		}
		catch (Exception e)
		{
			out.println(e.getMessage());
		}*/con.close();
 %>
<a href="success.jsp">Auction List</a>
</body>
</html>